<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head.ejs') %>
    <title><%= title %></title>
    
</head>

<body>
  <header>
    <%- include('../partials/header.ejs') %>
    <% var funciona = false %>
  </header>
  <main>
    <%- existingUser ? console.log("Se encontro algo en usuarios existentes", existingUser) : "" %>
    <form class="form-create-product needs-validation" id="form" action="#" method="post" enctype="multipart/form-data"
      novalidate>
      <section style="min-height:100vh" class="d-flex align-items-center justify-content-center">
        <div class="container py-5 h-100">
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-lg-9 mb-4 mb-lg-0">
              <div class="card mb-3" style="border-radius: .5rem;">

                <!-- UP SECTION -->
                <div class="row g-0">
                  <!-- IMAGE SECTION -->
                  <div class="col-md-4 gradient-custom text-center text-gray"
                    style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
                    <div class="form-group input-field-register row">
                      <label for="user_image" class="text-center text-white">Foto de perfil</label>
                      <div class="rounded-image text-center">
                        <img src="images/users/avatar.png" class="img-fluid w-90 p-5" />
                      </div>
                      <div class="d-flex justify-content-center">
                        <div class="btn btn-light btn-rounded" style="padding: 5px">
                          <label class="form-label text-black m-1" for="customFile1">Seleccionar foto de
                            perfil</label>
                          <input type="file" class="form-control" id="user_image" name="user_image"
                            accept=".jpg, .png, .jpeg, .webp" />
                        </div>
                      </div>

                    </div>

                  </div>

                  <!-- USER DETAILS SECTION -->
                  <div class="col-md-8">
                    <div class="card-body p-4 text-center">
                      <h1>NUEVO USUARIO</h1>
                      <hr class="mt-0 mb-4">
                      <% if(existingUser) { %>
                      <div id="alert_user_existent" class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                          class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img"
                          aria-label="Warning:">
                          <path
                            d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
                        </svg>
                        <div>
                          Parece que este usuario ya existe en base de datos, vuelve a intentar con datos diferentes.
                        </div>
                      </div>
                      <% }; %>

                      <div class="row pt-1">
                        <div class="form-floating mb-3 col">
                          <input type="text" name="user_name" id="user_name" class="form-control" minlength="3"
                            value="<%= locals.validData ? locals.validData.user_name : '' %>" minlength="2" required>
                          <label for="user_name">NOMBRE/S</label>
                          <div class="invalid-feedback">
                            El nombre del usuario es requerido.
                          </div>
                        </div>
                        <div class="form-floating mb-3 col">
                          <input type="text" class="form-control" name="user_surname"
                          id="user_surname" value="<%= locals.validData ? locals.validData.user_surname : '' %>"
                          minlength="2" required>
                          <label for="user_surname">APELLIDO</label>
                          <div class="invalid-feedback">
                            El apellido del usuario es requerido.
                          </div>
                        </div>
                      </div>
                      <div class="row pt-1">
                        <div class="form-floating mb-3 col">
                          <input type="text" class="form-control" name="user_user_name"
                          id="user_user_name" value="<%= locals.validData ? locals.validData.user_user_name : '' %>"
                          minlength="3" required>
                          <label for="user_user_name">NOMBRE USUARIO</label>
                          <div class="invalid-feedback">
                            El username es requerido.
                          </div>
                        </div>
                        <div class="form-floating mb-3 col">
                          <input type="email" class="form-control" name="user_email"
                          id="user_email" value="<%= locals.validData ? locals.validData.user_email : '' %>"
                          minlength="1" required>
                          <label for="user_email">EMAIL</label>
                          <div class="invalid-feedback">
                            El email es requerido.
                          </div>
                        </div>
                      </div>
                      <div class="row pt-1">
                        <div class="form-floating mb-3 col">
                          <input type="email" class="form-control"
                          name="user_email_confirm" id="user_email_confirm"
                          value="<%= locals.validData ? locals.validData.user_email_confirm : '' %>" minlength="1"
                          required>
                          <label for="user_email_confirm">CONFIRMAR EMAIL</label>
                          <div class="invalid-feedback">
                            Debe confirmar el email
                          </div>
                        </div>
                        <div class="form-floating mb-3 col">
                          <input type="password" class="form-control" name="user_pass"
                          id="user_pass" value="<%= locals.validData ? locals.validData.user_pass : '' %>"
                          minlength="8" required>
                          <label for="user_pass">CONTRASEÑA</label>
                          <div class="invalid-feedback">
                            La contraseña es requerida
                          </div>
                        </div>
                      </div>
                      <div class="row pt-1">
                        <div class="form-floating mb-3 col">
                          <input type="password" class="form-control"
                          name="user_pass_confirm" id="user_pass_confirm"
                          value="<%= locals.validData ? locals.validData.user_pass_confirm : '' %>" minlength="8"
                          required>
                          <label for="user_pass_confirm">CONFIRMAR CONTRASEÑA</label>
                          <div class="invalid-feedback">
                            Debe confirmar la contraseña
                          </div>
                        </div>
                        <div class="form-floating mb-3 col">
                          <% if (locals._locals.usuario) { %>
                            <% if (locals._locals.usuario.roles_id == 1) { %>
                              <%if(usuario.roles_id == 1){ %>
                                <select class="form-select" name="roles_id" id="roles_id"
                                aria-label="Default select example" required>
                                <option selected value="1">Administrador</option>
                                <option value="2">Cliente</option>
                              <% }else if(usuario.roles_id == 2){ %>
                                <option selected value="2">Cliente</option>
                                <option value="1">Administrador</option>
                              <% } %>                             
                              </select>
                              <label for="roles_id">ROL</label>
                            <% } %>
                          <% } %>
                        </div>
                      </div>
                      <div class="row pt-1">
                        <div class="form-floating mb-3 col">
                          <input type="text" class="form-control" name="user_address"
                          id="user_address" value="<%= locals.validData ? locals.validData.user_address : '' %>"
                          minlength="1" required>
                          <label for="user_address">DIRECCION ENVIOS</label>
                          <div class="invalid-feedback">
                            La dirección es requerida
                          </div>
                        </div>
                      </div>
                    </div>
                    <% if( locals.errors) { %>
                    <p>Se presentaron errores en la creación del usuario:</p>
                    <p style="color: red"><%- errors.user_name ? errors.user_name.msg : "" %></p>
                    <p style="color: red"><%- errors.user_surname ? errors.user_surname.msg : "" %></p>
                    <p style="color: red"><%- errors.user_user_name ? errors.user_user_name.msg : "" %></p>
                    <p style="color: red"><%- errors.user_email ? errors.user_email.msg : "" %></p>
                    <p style="color: red"><%- errors.user_email_confirm ? errors.user_email_confirm.msg : "" %></p>
                    <p style="color: red"><%- errors.user_pass ? errors.user_pass.msg : "" %></p>

                    <% } %>
                  </div>
                </div>

                <!-- BUTTONS SECTION -->
                <div class="container text-center bg-dark rounded-bottom py-3">
                  <div class="row gx-5 justify-content-center">
                    <div class="col-12 col-md-4 my-2">
                      <button type="submit" class="btn btn-success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                          class="bi bi-box-arrow-down" viewBox="0 0 16 16">
                          <path fill-rule="evenodd"
                            d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1h-2z" />
                          <path fill-rule="evenodd"
                            d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z" />
                        </svg>
                        GUARDAR
                      </button>
                    </div>
                    <div class="col-12 col-md-4 my-2">
                      <button class="btn btn-light" onclick="resetForm()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                          class="bi bi-pencil-square" viewBox="0 0 16 16">
                          <path
                            d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                          <path fill-rule="evenodd"
                            d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                        </svg>
                        LIMPIAR
                      </button>
                    </div>
                    <div class="col-12 col-md-4 my-2">
                      <a href="/login">
                        <button type="button" class="btn btn-light">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            class="bi bi-x-square" viewBox="0 0 16 16">
                            <path
                              d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                            <path
                              d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                          </svg>
                          CANCELAR
                        </button>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </form>
    </section>
    <script type="application/javascript" src="/js/validationUsers.js"></script>
  </main>

  <footer>
    <%- include('../partials/footer.ejs') %>
  </footer>

  
  <script src="/js/bootstrap.bundle.min.js"></script>
</body>

</html>