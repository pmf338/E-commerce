<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head.ejs') %>
  <link rel="stylesheet" href="/css/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title><%= title %></title>
    
</head>

<body>
  <header>
    <%- include('../partials/header.ejs') %>
  </header>
  <main>
    <%- existingUser ? console.log("Se encontro algo en usuarios existentes", existingUser) : "" %>
    <section class="vh-250"
      style="background: url('https://www.unidiversidad.com.ar/cache/recitales-cultura_1000_1100.jpg'); background-size: cover;">

      <form class="form-create-product needs-validation" id="form" action="#" method="post" enctype="multipart/form-data" novalidate>
        <section class="vh-120"
          style="background: url('https://www.unidiversidad.com.ar/cache/recitales-cultura_1000_1100.jpg')">
          <div class="container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
              <div class="col col-lg-9 mb-4 mb-lg-0">
                <div class="card mb-3" style="border-radius: .5rem; ">
                  </br>
                  <div class="row g-0">
                    <h3 class="display-6 card-title text-center text-gray">Crear perfil de usuario</h1>

                      <div class="col-md-4 gradient-custom text-center text-gray"
                        style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
                        <div class="form-group input-field-register row">
                          <label for="user_image" class="text-center text-white">Foto de perfil</label>
                          <div class="rounded-image text-center">
                            <img src="images/users/avatar.png" class="img-fluid w-90 p-5" />
                          </div>
                          <div class="d-flex justify-content-center">
                            <div class="btn btn-light btn-rounded" style="padding: 5px">
                              <label class="form-label text-black m-1" for="customFile1">Seleccionar foto de
                                perfil</label>
                              <input type="file" class="form-control" id="user_image" name="user_image"
                                accept=".jpg, .png, .jpeg, .webp" />
                            </div>
                          </div>

                        </div>
                      </br>
                      <button class="btn btn-primary" onclick="resetForm()">
                        Limpiar formulario
                      </button>
                      </br>
                        </br>
                        <button type="submit" class="btn btn-success">
                          Guardar cambios
                        </button>
                        </br>
                        </br>
                        <a href="/login">
                          <button type="button" class="btn btn-warning">
                            Cancelar
                          </button>
                        </a>
                        </br>
                        </br>
                      </div>

                      <div class="col-md-8">
                        <div class="card-body p-4">
                          <h6>Crear perfil de usuario</h6>
                          <hr class="mt-0 mb-4">
                          <div class="row pt-1">

                            <% if(existingUser) { %>
                        
                              <div id="alert_user_existent" class="alert alert-danger d-flex align-items-center" role="alert">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                                  <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                                </svg>
                                <div>
                                    Parece que este usuario ya existe en base de datos, vuelve a intentar con datos diferentes.
                                </div>
                              </div>
                              <% }; %>

                            <div class="col-6 mb-3">
                              <h6>Nombre/s </h6>
                              <i class="fa-solid fa-user"></i><input type="text" class="form-control" name="user_name"
                                id="user_name" value="<%= locals.validData ? locals.validData.user_name : '' %>" minlength="2" required>
                                <div class="invalid-feedback">
                                  El nombre del usuario es requerido.
                                </div>
                            </div>

                            <div class="col-6 mb-3">
                              <h6>Apellido/s </h6>
                              <i class="fa-solid fa-user"></i><input type="text" class="form-control"
                                name="user_surname" id="user_surname" value="<%= locals.validData ? locals.validData.user_surname : '' %>" minlength="2" required>
                                <div class="invalid-feedback">
                                  El apellido del usuario es requerido.
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <h6>Nombre de usuario</h6>
                              <i class="fa-solid fa-user"></i><input type="text" class="form-control"
                                name="user_user_name" id="user_user_name" value="<%= locals.validData ? locals.validData.user_user_name : '' %>" minlength="1" required>
                                <div class="invalid-feedback">
                                  El username es requerido.
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <h6>Correo electronico</h6>
                              <i class="fa-solid fa-user"></i><input type="email" class="form-control" name="user_email"
                                id="user_email" value="<%= locals.validData ? locals.validData.user_email : '' %>" minlength="1" required>
                                <div class="invalid-feedback">
                                  El email es requerido.
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <h6>Confirmar correo electronico</h6>
                              <i class="fa-solid fa-user"></i><input type="email" class="form-control"
                                name="user_email_confirm" id="user_email_confirm" value="<%= locals.validData ? locals.validData.user_email_confirm : '' %>" minlength="1" required>
                                <div class="invalid-feedback">
                                  Debe confirmar el email 
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <h6>Contraseña</h6>
                              <i class="fa-solid fa-user"></i><input type="password" class="form-control"
                                name="user_pass" id="user_pass" value="<%= locals.validData ? locals.validData.user_pass : '' %>" minlength="8" required>
                                <div class="invalid-feedback">
                                  La contraseña es requerida 
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <h6>Confirmar contraseña</h6>
                              <i class="fa-solid fa-user"></i><input type="password" class="form-control"
                                name="user_pass_confirm" id="user_pass_confirm" value="<%= locals.validData ? locals.validData.user_pass_confirm : '' %>" minlength="8" required>
                                <div class="invalid-feedback">
                                  Debe confirmar la contraseña 
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <h6>Dirección para envios</h6>
                              <i class="fa-solid fa-user"></i><input type="text" class="form-control"
                                name="user_address" id="user_address" value="<%= locals.validData ? locals.validData.user_address : '' %>" minlength="1" required>
                                <div class="invalid-feedback">
                                  La dirección es requerida 
                                </div>
                              </div>

                            <div class="col-6 mb-3">
                              <% if (locals.usuario) { %>
                              <% if (locals.usuario.roles_id == 1) { %>
                                <h6>Categoria del usuario</h6>
                                <select class="form-select col-6 mb-3"  name="roles_id" id="roles_id" required>
                                  <option selected></option>
                                  <option value="1">Administrador</option>
                                  <option value="2">Cliente</option>
                                </select>
                              <% } %>
                              <% } %>
                            </div>
                          </div>
                        </div>
                        <% if( locals.errors) { %>
                          <p>Se presentaron errores en la creación del usuario:</p>
                          <p style="color: red"><%- errors.user_name ? errors.user_name.msg : "" %></p>
                          <p style="color: red"><%- errors.user_surname ? errors.user_surname.msg : "" %></p>
                          <p style="color: red"><%- errors.user_email ? errors.user_email.msg : "" %></p>
                          <p style="color: red"><%- errors.user_email_confirm ? errors.user_email_confirm.msg : "" %></p>
                          <p style="color: red"><%- errors.user_pass ? errors.user_pass.msg : "" %></p>
                          
                          <% } %>
                      </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </form>
    </section>
  </main>

  <footer>
    <%- include('../partials/footer.ejs') %>
  </footer>

  <script type="application/javascript" src="/js/validatorUsers.js"></script>
  <script src="/js/bootstrap.bundle.min.js"></script>
</body>

</html>